@use "sass:color";
@use "../libs/functions" as f;
@use "../libs/mixins" as m; 
@use "../libs/breakpoints" as s; 

$btn-transition-base: f.duration(transition) ease-in-out;
$btn-height: 3.5em;

@mixin next-arrow-svg($stroke-color) {
    background-image: f.svg-url('<svg xmlns="http://www.w3.org/2000/svg" width="36px" height="24px" viewBox="0 0 36 24"><style>line { stroke: #{$stroke-color}; stroke-width: 2px; }</style><line x1="0" y1="12" x2="34" y2="12" /><line x1="25" y1="4" x2="34" y2="12.5" /><line x1="25" y1="20" x2="34" y2="11.5" /></svg>');
}

/* Button Base */
input[type="submit"],
input[type="reset"],
input[type="button"],
button,
.button {
    appearance: none;
    transition: background-color #{$btn-transition-base},
                box-shadow #{$btn-transition-base},
                color #{$btn-transition-base};
    
    // 1. Refactored Layout with Flexbox
    display: inline-flex;
    align-items: center;    // Vertically centers text/icons
    justify-content: center; // Horizontally centers content
    
    background-color: transparent;
    border: 0;
    border-radius: 0;
    box-shadow: inset 0 0 0 2px f.palette(fg-bold);
    color: f.palette(fg-bold);
    cursor: pointer;
    font-size: 0.8em;
    font-weight: f.font(weight-bold);
    height: $btn-height;
    // Removed line-height: Flexbox handles this now
    letter-spacing: f.font(letter-spacing-alt);
    padding: 0 1.75em;
    text-align: center;
    text-decoration: none;
    text-transform: uppercase;
    white-space: nowrap;

    /* States: Hover & Active */
    &:hover {
        box-shadow: inset 0 0 0 2px f.palette(highlight);
        color: f.palette(highlight);
    }

    &:active {
        $active-color: color.scale(f.palette(highlight), $lightness: -15%, $saturation: -5%);
        background-color: color.scale(f.palette(highlight), $alpha: -90%);
        box-shadow: inset 0 0 0 2px $active-color;
        color: $active-color;
    }

    /* Modifiers */
    &.icon:before { 
        margin-right: 0.5em;
        // Ensures icon stays centered with text
        display: block; 
    }
    
    &.fit {
        display: flex; // Changes from inline-flex to full-width flex
        width: 100%;
        margin: 0 0 (f.size(element-margin) * 0.5) 0;
    }

    &.small { font-size: 0.6em; }
    
    &.big {
        font-size: 1.25em;
        height: 3em; // Keeps fixed height but Flexbox re-centers text
    }

    /* Special Styling */
    &.special {
        background-color: f.palette(fg-bold);
        box-shadow: none;
        color: f.palette(bg);

        &:hover {
            background-color: f.palette(highlight);
            color: f.palette(bg) !important;
        }

        &:active {
            background-color: color.scale(f.palette(highlight), $lightness: -15%, $saturation: -5%);
        }
    }

    /* Next Button Logic */
    &.next {
        padding-right: 4.5em;
        position: relative;

        // Using flex alignment inside the pseudo-elements
        &:before, &:after {
            transition: opacity #{$btn-transition-base};
            background-position: center right;
            background-repeat: no-repeat;
            background-size: 36px 24px;
            content: '';
            height: 100%;
            position: absolute;
            right: 1.5em;
            top: 0;
            width: 36px;
        }

        &:before { @include next-arrow-svg(f.palette(fg-bold)); }
        &:after  { @include next-arrow-svg(f.palette(highlight)); opacity: 0; z-index: 1; }

        &:hover:after, &:active:after { opacity: 1; }

        @include s.breakpoint(large) { padding-right: 5em; }
    }

    &.disabled, &:disabled {
        pointer-events: none;
        cursor: default;
        opacity: 0.25;
    }
}